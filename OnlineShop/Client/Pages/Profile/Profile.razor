@page "/profile"
@layout MainLayout
@using OnlineShop.Client.Services.State
@using OnlineShop.Shared
@using System.Net
@using OnlineShop.Client.Pages.Auth
@inject AppState _appState
@inject HttpClient client
@inject IDialogService Dialog

<h3>Profile</h3>
<MudText>User: @_appState.UserState.UserName</MudText>
<MudTabs Outlined="true" Position="Position.Top" Rounded="true" Border="true" ApplyEffectsToContainer="true" Class="mt-8" PanelClass="pa-6">
    <MudTabPanel Text="Покупки" Icon="@Icons.Material.Filled.ShoppingCart">
        <PurchaseView Purchases="Purchases"></PurchaseView>
    </MudTabPanel>
    <MudTabPanel Text="Сохраненные рисунки" Icon="@Icons.Material.Filled.Image">
        <ImagesView Images="Images"></ImagesView>
    </MudTabPanel>
</MudTabs>

@code {
    public UserImage[] Images;
    public PurchaseGoods[] Purchases;

    protected override async Task OnInitializedAsync()
    {
        var requestOperations = await client.PutAsync("api/Operations", null);
        var requestImages = await client.PutAsync("api/Images", null);
        if (requestOperations.StatusCode != HttpStatusCode.Unauthorized && requestImages.StatusCode != HttpStatusCode.Unauthorized)
        {
            Purchases = await requestOperations.Content.ReadFromJsonAsync<PurchaseGoods[]>();
            Images = await requestImages.Content.ReadFromJsonAsync<UserImage[]>();
        }
        else
        {
            Dialog.Show<AuthDialog>();
        }
    }

    
}